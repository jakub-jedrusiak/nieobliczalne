{
  "hash": "490cc4d9bf9d424f0a5895a619fc4b4e",
  "result": {
    "markdown": "---\ntitle: \"Listy, pętle i automatyzacja w R\"\ndescription: \"Automatyzacja to jedna z najpotężniejszych zalet R, której nie mają programy statystyczne oparte na interfejsie graficznym. Jeśli chcemy zrobić jakąś czynność wiele razy tak samo lub prawie tak samo, możemy wykorzystać siłę programowania i zrobić to setki razy kilkoma linijkami. Postaram się to tutaj pokazać.\"\nimage: ./headers/automatyzacja.webp\ndate: \"2023-03-08\"\ncategories:\n    - R\n---\n\n\n\n\nNie znoszę mechanicznej pracy. Jestem jedną z tych osób, które wolą spędzić 30 minut na automatyzacji czegoś, co ręcznie zrobiłbym w 15 minut. Ale ma to swoje zalety. Po pierwsze poświęciłem na to tyle czasu, że teraz jestem w stanie wiele rzeczy zautomatyzować dość szybko. Tym doświadczeniem chcę się też podzielić. Po drugie jeśli praca manualna wielokrotnie się powtarza, netto oszczędzam czas, mimo że na początku muszę zainwestować tego czasu więcej. Raz zautomatyzowana czynność jest wielokrotnego użytku. Po trzecie jeśli automatyzujemy, to tyle samo zajmuje wyczyszczenie 1 pliku i 100 plików zajmuje tyle samo czasu. Jeśli liczymy, to 100 plików to 100 razy więcej czasu. Po czwarte -- mam ciekawsze rzeczy do roboty niż wypisywanie kolejnych liczb. Automatyzacja mnie chociaż nie nudzi, a mogę poświęcić swoje zasoby na opracowywanie, planowanie czy interpretacja.\n\n# Automatyzacja w czyszczeniu danych\n\nWeźmy sobie za przykład następującą sytuację -- wykonaliśmy eksperyment w programie PsychoPy i zbadaliśmy 35 osób. Nasz eksperyment dotyczył tego, na ile osoby będą w stanie zapamiętać historyjkę opowiadaną im w prawej słuchawce, jeśli w lewej słuchawce będzie im puszczany rozpraszacz. Mamy przy okazji dwa warunki, łatwy i trudny, w zależności od tego, jak intensywnie zachodziło rozpraszanie. Ze względu na specyfikę PsychoPy, otrzymaliśmy 35 osobnych plików z wynikami[^files]. Spojrzenie w przykładowy plik pozwala stwierdzić, że jest to kompletny chaos.\n\n[^files]: Bazy najlepiej pobrać na swój dysk z [repozytorium](https://github.com/jakub-jedrusiak/nieobliczalne/tree/main/posts/dane/automatyzacja).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse, quietly = TRUE)\n```\n\n<div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> ── </span><span style='color: #BB0000; font-weight: bold;'>Attaching core tidyverse packages</span><span style='color: #BB0000;'> ──────────────────────── tidyverse 2.0.0 ──\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>dplyr    </span><span style='color: #BB0000;'> 1.1.2     </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>purrr    </span><span style='color: #BB0000;'> 1.0.1\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>forcats  </span><span style='color: #BB0000;'> 1.0.0     </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>readr    </span><span style='color: #BB0000;'> 2.1.4\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>ggplot2  </span><span style='color: #BB0000;'> 3.4.2     </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>stringr  </span><span style='color: #BB0000;'> 1.5.0\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>lubridate</span><span style='color: #BB0000;'> 1.9.2     </span><span style='color: #00BB00;'>✔</span><span style='color: #BB0000;'> </span><span style='color: #0000BB;'>tidyr    </span><span style='color: #BB0000;'> 1.3.0\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> ── </span><span style='color: #BB0000; font-weight: bold;'>Conflicts</span><span style='color: #BB0000;'> ────────────────────────────────────────── tidyverse_conflicts() ──\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> ✖ </span><span style='color: #0000BB;'>dplyr</span><span style='color: #BB0000;'>::</span><span style='color: #00BB00;'>filter()</span><span style='color: #BB0000;'> masks </span><span style='color: #0000BB;'>stats</span><span style='color: #BB0000;'>::filter()\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> ✖ </span><span style='color: #0000BB;'>dplyr</span><span style='color: #BB0000;'>::</span><span style='color: #00BB00;'>lag()</span><span style='color: #BB0000;'>    masks </span><span style='color: #0000BB;'>stats</span><span style='color: #BB0000;'>::lag()\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>ℹ</span><span style='color: #BB0000;'> Use the conflicted package (</span><span style='color: #0000BB; font-style: italic;'>&lt;http://conflicted.r-lib.org/&gt;</span><span style='color: #BB0000;'>) to force all conflicts to become errors\n</span></code></pre></div>\n\n```{.r .cell-code}\n\nread_csv(\"./dane/automatyzacja/BD_eksperyment_latwy_2021_Apr_24_1631.csv\")\n```\n\n<div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> New names:\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Rows: </span><span style='color: #0000BB;'>12</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Columns: </span><span style='color: #0000BB;'>19</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>──</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Column specification</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>────────────────────────────────────────────────────────</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Delimiter:</span><span style='color: #BB0000;'> \",\" chr\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> (13): form.itemText, form.type, form.response, form.rt, form_2.itemText,... </span><span style='color: #00BB00;'>dbl</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> (5): form.index, form_2.index, form_2.rt, zakonczenie_instrukcja.starte... </span><span style='color: #BBBB00;'>lgl</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> (1): ...19\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>ℹ</span><span style='color: #BB0000;'> Use `spec()` to retrieve the full column specification for this data. </span><span style='color: #00BBBB;'>ℹ</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> Specify the column types or set `show_col_types = FALSE` to quiet this message.\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>•</span><span style='color: #BB0000;'> `` -&gt; `...19`\n</span></code></pre></div><div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># A tibble: 12 × 19</span>\n<span style='color: #555555;'>#&gt;</span>    <span style='font-weight: bold;'>form.index</span> <span style='font-weight: bold;'>form.itemText</span>         <span style='font-weight: bold;'>form.type</span> <span style='font-weight: bold;'>form.response</span> <span style='font-weight: bold;'>form.rt</span> <span style='font-weight: bold;'>form_2.index</span>\n<span style='color: #555555;'>#&gt;</span>         <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>                 <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>     <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>         <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>          <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 1</span>          1 Jaka jest twoja plec? choice    kobieta       3.0891…           <span style='color: #BB0000;'>NA</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 2</span>          2 Jaki jest twoj wiek?  free text 17            None              <span style='color: #BB0000;'>NA</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 3</span>          3 Czy wyrazasz zgode n… choice    tak           10.844…           <span style='color: #BB0000;'>NA</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 4</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 1\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 5</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 2\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 6</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 3\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 7</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 4\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 8</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 5\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 9</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 6\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>10</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 7\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>11</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                 8\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>12</span>         <span style='color: #BB0000;'>NA</span> <span style='color: #BB0000;'>NA</span>                    <span style='color: #BB0000;'>NA</span>        <span style='color: #BB0000;'>NA</span>            <span style='color: #BB0000;'>NA</span>                <span style='color: #BB0000;'>NA</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># ℹ 13 more variables: </span><span style='color: #555555; font-weight: bold;'>form_2.itemText</span><span style='color: #555555;'> &lt;chr&gt;, </span><span style='color: #555555; font-weight: bold;'>form_2.type</span><span style='color: #555555;'> &lt;chr&gt;,</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>#   </span><span style='color: #555555; font-weight: bold;'>form_2.response</span><span style='color: #555555;'> &lt;chr&gt;, </span><span style='color: #555555; font-weight: bold;'>form_2.rt</span><span style='color: #555555;'> &lt;dbl&gt;,</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>#   </span><span style='color: #555555; font-weight: bold;'>zakonczenie_instrukcja.started</span><span style='color: #555555;'> &lt;dbl&gt;, </span><span style='color: #555555; font-weight: bold;'>zakonczenie_instrukcja.stopped</span><span style='color: #555555;'> &lt;chr&gt;,</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>#   </span><span style='color: #555555; font-weight: bold;'>participant</span><span style='color: #555555;'> &lt;chr&gt;, </span><span style='color: #555555; font-weight: bold;'>session</span><span style='color: #555555;'> &lt;chr&gt;, </span><span style='color: #555555; font-weight: bold;'>date</span><span style='color: #555555;'> &lt;chr&gt;, </span><span style='color: #555555; font-weight: bold;'>expName</span><span style='color: #555555;'> &lt;chr&gt;,</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>#   </span><span style='color: #555555; font-weight: bold;'>psychopyVersion</span><span style='color: #555555;'> &lt;chr&gt;, </span><span style='color: #555555; font-weight: bold;'>frameRate</span><span style='color: #555555;'> &lt;dbl&gt;, </span><span style='color: #555555; font-weight: bold;'>...19</span><span style='color: #555555;'> &lt;lgl&gt;</span>\n</code></pre></div>\n:::\n\n\nPierwsze 3 wiersze zawierają informacje metryczkowe. Kolejnych 8 zawiera odpowiedzi na pytania, ale w innych kolumnach. Wiersz 12. nie zawiera żadnych użytecznych informacji, bo tylko czas, jaki osoba badana spędziła na czytaniu ostatniej instrukcji. Co więcej, identyfikatorem osoby badanej były inicjały, więc w wielu przypadkach mamy powtórzenia (np. dwie osoby o inicjałach MK). Zasadniczo jest tu wiele niedociągnięć co do projektu bazy i nie ma się co dziwić -- dane nie są spreparowane, to projekt studencki. Cenne doświadczenie, które pokazuje, czego w przyszłości unikać.\n\nTrzeba się trochę nagłowić, żeby takie dane wyczyścić. Pewnym ułatwieniem jest, że wszystkie te pliki mają identyczną strukturę. Ja wykorzystałem tutaj taki kod:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbaza_raw <- read_csv(\"./dane/automatyzacja/BD_eksperyment_latwy_2021_Apr_24_1631.csv\")\n```\n\n<div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> New names:\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Rows: </span><span style='color: #0000BB;'>12</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Columns: </span><span style='color: #0000BB;'>19</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>──</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Column specification</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>────────────────────────────────────────────────────────</span><span style='color: #BB0000;'> </span><span style='color: #BB0000; font-weight: bold;'>Delimiter:</span><span style='color: #BB0000;'> \",\" chr\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> (13): form.itemText, form.type, form.response, form.rt, form_2.itemText,... </span><span style='color: #00BB00;'>dbl</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> (5): form.index, form_2.index, form_2.rt, zakonczenie_instrukcja.starte... </span><span style='color: #BBBB00;'>lgl</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> (1): ...19\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>ℹ</span><span style='color: #BB0000;'> Use `spec()` to retrieve the full column specification for this data. </span><span style='color: #00BBBB;'>ℹ</span><span style='color: #BB0000;'>\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> Specify the column types or set `show_col_types = FALSE` to quiet this message.\n</span><span style='color: #555555;'>#&gt;</span><span style='color: #BB0000;'> </span><span style='color: #00BBBB;'>•</span><span style='color: #BB0000;'> `` -&gt; `...19`\n</span></code></pre></div>\n\n```{.r .cell-code}\n\n# najpierw sama metryczka\nmetryczka <- baza_raw %>%\n    slice(1:2) %>% # wybierz wiersze z samej metryczki\n    select(participant, expName, 2, 4) %>% # wybierz kolumny z id, pytaniem i odpowiedzią\n    pivot_wider(names_from = form.itemText, values_from = form.response) %>% # format długi\n    set_names(\"id\", \"warunek\", \"plec\", \"wiek\") %>%\n    mutate(\n        wiek = parse_number(wiek),\n        warunek = str_remove(warunek, \"eksperyment_\") # zostaw samo łatwy albo trudny\n    )\n\n# potem same odpowiedzi na pytania\npytania <- baza_raw %>%\n    slice(4:11) %>%\n    select(form_2.itemText, form_2.response) %>%\n    mutate(\n        form_2.response = case_match( # tak i nie na 1 i 0\n        form_2.response,\n        \"tak\" ~ 1,\n        \"nie\" ~ 0\n        )\n    ) %>%\n    pivot_wider(names_from = form_2.itemText, values_from = form_2.response) %>%\n    set_names(paste0(\"pyt_\", 1:8))\n\n# na koniec łączę\nbaza <- bind_cols(metryczka, pytania) %>%\n    mutate(\n        id = stringi::stri_rand_strings(1, 5) # zamień id na losowe znaki\n    )\n\nbaza\n```\n\n<div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># A tibble: 1 × 12</span>\n<span style='color: #555555;'>#&gt;</span>   <span style='font-weight: bold;'>id</span>    <span style='font-weight: bold;'>warunek</span> <span style='font-weight: bold;'>plec</span>     <span style='font-weight: bold;'>wiek</span> <span style='font-weight: bold;'>pyt_1</span> <span style='font-weight: bold;'>pyt_2</span> <span style='font-weight: bold;'>pyt_3</span> <span style='font-weight: bold;'>pyt_4</span> <span style='font-weight: bold;'>pyt_5</span> <span style='font-weight: bold;'>pyt_6</span> <span style='font-weight: bold;'>pyt_7</span> <span style='font-weight: bold;'>pyt_8</span>\n<span style='color: #555555;'>#&gt;</span>   <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>   <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>   <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>1</span> 5pb90 latwy   kobieta    17     1     <span style='color: #555555;'>0</span>     1     1     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     1\n</code></pre></div>\n:::\n\n\nZ ciekawszych rzeczy wykorzystuję tutaj funkcję `stri_rand_strings` z pakietu `stringi`, żeby zmienić ID osoby badanej. ID nie musi tutaj nic znaczyć, ma być po prostu unikalne. A z tym mamy tutaj problem, bo się wcześniej nie umówiliśmy na żaden sensowny sposób kodowania osób badanych. Dlatego na tym etapie mogę zastąpić inicjały losowym ciągiem 5 znaków, zapewniając sobie, że w ostatecznej bazie identyfikatory będą unikalne. Jest to też sposób na anonimizację bazy danych.\n\nUzyskaliśmy w ten sposób jeden wyczyszczony wiersz. Jeszcze tylko 34. I jak mamy to zrobić? Mamy ten sam kod skopiować jeszcze 34 razy? A co jeśli mam 1000 osób? A co jeśli jestem Martą Kowal[^kowal] i mam do przeanalizowania (ponad) 93 158 osób [@kowal_predictors_2022]? Kopiowanie kodu nigdy nie jest dobrą drogą. Jeśli często kopiujemy kod, powinniśmy zrobić z niego funkcję. Jeśli tę samą funkcję chcemy zastosować do wielu obiektów, powinniśmy użyć list albo pętli.\n\n[^kowal]: Którą serdecznie pozdrawiam.\n\n# Listy\n\nPodstawową metodą automatyzacji we wszystkich językach programowania są pętle. W R też one występują, można z nich korzystać i omówię je, jednak pętle w R nie są najlepszą metodą. Są one mało wydajne. Jeśli chcemy coś wykonać wielokrotnie, najlepszą drogą -- o ile to możliwe -- są listy. Lista to szczególny typ danych w R, którego największą zaletą jest to, że może przechowywać inne formy danych. Innymi słowy możemy szybko zrobić *listę* naszych surowych baz danych, które chcemy potem wyczyścić. Co ważniejsze, możemy potem do każdego elementu listy zastosować jakąś funkcję.\n\nListę tworzymy przede wszystkim przez komendę `list`. Możemy do niej wrzucić rzeczy, które chcemy przerobić na listę. Dla przykładu zróbmy listę z dwóch wbudowanych baz danych -- `iris` i `mpg`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbazy_danych <- list(\n    as_tibble(iris), # tibble dla lepszego drukowania w konsoli\n    as_tibble(mpg)\n)\n\nbazy_danych\n```\n\n<div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span> [[1]]\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># A tibble: 150 × 5</span>\n<span style='color: #555555;'>#&gt;</span>    <span style='font-weight: bold;'>Sepal.Length</span> <span style='font-weight: bold;'>Sepal.Width</span> <span style='font-weight: bold;'>Petal.Length</span> <span style='font-weight: bold;'>Petal.Width</span> <span style='font-weight: bold;'>Species</span>\n<span style='color: #555555;'>#&gt;</span>           <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span>       <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span>        <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span>       <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;fct&gt;</span>  \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 1</span>          5.1         3.5          1.4         <span style='color: #555555;'>0.</span>2 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 2</span>          4.9         3            1.4         <span style='color: #555555;'>0.</span>2 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 3</span>          4.7         3.2          1.3         <span style='color: #555555;'>0.</span>2 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 4</span>          4.6         3.1          1.5         <span style='color: #555555;'>0.</span>2 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 5</span>          5           3.6          1.4         <span style='color: #555555;'>0.</span>2 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 6</span>          5.4         3.9          1.7         <span style='color: #555555;'>0.</span>4 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 7</span>          4.6         3.4          1.4         <span style='color: #555555;'>0.</span>3 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 8</span>          5           3.4          1.5         <span style='color: #555555;'>0.</span>2 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 9</span>          4.4         2.9          1.4         <span style='color: #555555;'>0.</span>2 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>10</span>          4.9         3.1          1.5         <span style='color: #555555;'>0.</span>1 setosa \n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># ℹ 140 more rows</span>\n<span style='color: #555555;'>#&gt;</span> \n<span style='color: #555555;'>#&gt;</span> [[2]]\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># A tibble: 234 × 11</span>\n<span style='color: #555555;'>#&gt;</span>    <span style='font-weight: bold;'>manufacturer</span> <span style='font-weight: bold;'>model</span>      <span style='font-weight: bold;'>displ</span>  <span style='font-weight: bold;'>year</span>   <span style='font-weight: bold;'>cyl</span> <span style='font-weight: bold;'>trans</span> <span style='font-weight: bold;'>drv</span>     <span style='font-weight: bold;'>cty</span>   <span style='font-weight: bold;'>hwy</span> <span style='font-weight: bold;'>fl</span>    <span style='font-weight: bold;'>class</span>\n<span style='color: #555555;'>#&gt;</span>    <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>        <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>      <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;int&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;int&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;int&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;int&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 1</span> audi         a4           1.8  <span style='text-decoration: underline;'>1</span>99<span style='color: #555555;'>9</span>     4 auto… f        18    29 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 2</span> audi         a4           1.8  <span style='text-decoration: underline;'>1</span>99<span style='color: #555555;'>9</span>     4 manu… f        21    29 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 3</span> audi         a4           2    <span style='text-decoration: underline;'>2</span>00<span style='color: #555555;'>8</span>     4 manu… f        20    31 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 4</span> audi         a4           2    <span style='text-decoration: underline;'>2</span>00<span style='color: #555555;'>8</span>     4 auto… f        21    30 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 5</span> audi         a4           2.8  <span style='text-decoration: underline;'>1</span>99<span style='color: #555555;'>9</span>     6 auto… f        16    26 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 6</span> audi         a4           2.8  <span style='text-decoration: underline;'>1</span>99<span style='color: #555555;'>9</span>     6 manu… f        18    26 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 7</span> audi         a4           3.1  <span style='text-decoration: underline;'>2</span>00<span style='color: #555555;'>8</span>     6 auto… f        18    27 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 8</span> audi         a4 quattro   1.8  <span style='text-decoration: underline;'>1</span>99<span style='color: #555555;'>9</span>     4 manu… 4        18    26 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 9</span> audi         a4 quattro   1.8  <span style='text-decoration: underline;'>1</span>99<span style='color: #555555;'>9</span>     4 auto… 4        16    25 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>10</span> audi         a4 quattro   2    <span style='text-decoration: underline;'>2</span>00<span style='color: #555555;'>8</span>     4 manu… 4        20    28 p     comp…\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># ℹ 224 more rows</span>\n</code></pre></div>\n:::\n\n\nGdy wywołamy naszą listę w konsoli, zobaczymy, że wyświetlają nam się dwie bazy danych, w takiej kolejności, w jakiej je wprowadziliśmy. Oczywiście w liście zmieści się dużo więcej elementów niż dwa. Jeśli chcemy dostać tylko jeden element, używamy składni `nazwa_listy[[indeks]]`[^indeks], czyli na przykład `bazy_danych[[1]]`. W tym wypadku spowoduje to wyciągnięcie samej tylko bazy `iris`. Co ciekawe, listy mogą zawierać też inne listy[^matrioszka], ale nie będziemy wchodzić w to tak głęboko. Możemy też wywołać `bazy_danych[1]`, ale taki zapis powoduje subtelną różnicę -- efektem jest jednoelementowa lista, zaś składnia z podwójnymi nawiasami wyciąga sam 1. element (w naszym przypadku bazę danych `iris`, czyli obiekt tibble). Na początku nie trzeba tego jakoś głęboko rozumieć, wystarczy na wiarę przyjąć, że potrzebne są dwa nawiasy kwadratowe.\n\n[^indeks]: W R indeksowanie zaczyna się od 1, a nie od 0 jak w C czy w pythonie. Takie indeksy są bardziej intuicyjne dla osób bez wprawy informatycznej.\n[^matrioszka]: Wtedy pojedyncze elementy wydobywalibyśmy składnią typu `lista[2][5]`, co oznacza 5. element listy z indeksem 2.\n\n## Masowe ładowanie danych z `list.files`\n\nKomenda `list` jest fajna, o ile mamy dane już załadowane. My mamy 35 plików w folderze, które dopiero musimy załadować. Możemy je jednak załadować wszystkie jednocześnie, od razu do listy. Wykorzystamy w tym celu funkcję `list.files` (lub zamiennie `dir`, to dwie nazwy tej samej funkcji). Zwraca ona listę plików znajdujących się we wskazanym folderze. Domyślnie zwraca ona same nazwy, więc jeśli chcemy całe ścieżki (a chcemy, jeśli dane są w innym folderze, niż główny), to musimy dołożyć argument `full.names = TRUE`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbazy_lista <- list.files(\"./dane/automatyzacja\", full.names = TRUE)\n```\n:::\n\n\nJeśli wyświetlimy teraz `bazy_lista` zobaczymy listę naszych plików z ich względnymi ścieżkami. Lista plików to jednak nie są jeszcze załadowane bazy. Ale można je wykorzystać do załadowania baz! Spójrzmy na przykładową ścieżkę.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbazy_lista[1]\n```\n\n<div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span> [1] \"./dane/automatyzacja/AC_eksperyment_trudny_2021_Apr_22_2124.csv\"\n</code></pre></div>\n:::\n\n\nTo jest dokładnie to, co wrzucilibyśmy do funkcji `read_csv` chcąc rzeczywiście załadować nasze dane. Jeśli więc weźmiemy naszą listę ścieżek[^wektor] i powiemy R „każdą z tych ścieżek wrzuć po kolei do `read_csv`”, to będziemy mieli nasze bazy załadowane. Żeby zastosować jakąś funkcję osobno do każdego elementu listy[^wektor2], użyjemy jednej z funkcji z rodziny `apply` (`apply`, `sapply`, `lapply` lub `tapply`) albo ich odpowiednika z `tidyverse`, czyli `map` z pakietu `purrr`. Choć `apply` jest powszechniejsze[^lapply], my użyjemy tutaj bardziej intuicyjnego w obsłudze `map`.\n\n[^wektor]: Tak, wiem, że to nie jest lista, tylko wektor. Nie chcę tutaj dodatkowo gmatwać wprowadzając pojęcie wektora. Skutek jest jednak ten sam, nawet jeśli `list.files` rzeczywiście wyrzucałoby listę, dalej zrobilibyśmy dokładnie to samo.\n[^wektor2]: Lub wektora.\n[^lapply]: Funkcja niżej mogłaby być zapisana równie dobrze jako `lapply(bazy_lista, read_csv, show_col_types = FALSE, name_repair = \"unique_quiet\")`, ale `map`, a głównie jej pochodne, mają bardziej przejrzystą i konsekwentną konwencję nazywania.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbazy_lista <- map(bazy_lista, read_csv, show_col_types = FALSE, name_repair = \"unique_quiet\")\n```\n:::\n\n\n`map` przyjmuje, w podstawowej wersji, dwa argumenty. Pierwszym jest obiekt, do którego chcemy zastosować naszą funkcję, a drugim sama funkcja. Podobnie jak w `across` (patrz [tutaj](https://nieobliczalne.pl/posts/podstawy_R.html#sec-across)) chodzi nam o obiekt zawierający funkcję, a nie o efekt jej działania, dlatego **po nazwie funkcji nie dajemy nawiasów**. To bardzo częsty błąd. Jeśli chodzi o samo `read_csv` dodałem tutaj `show_col_types = FALSE` i `name_repair = \"unique_quiet\"`, żeby nasza konsola nie została zalana milionem informacji o aktualnie wczytywanej bazie.\n\nEfektem działania tej funkcji jest lista baz danych. Już nie ścieżek, a załadowanych baz. Skoro mamy je załadowane, możemy je wyczyścić.\n\n## Masowe czyszczenie z `map` lub `apply`\n\nSkoro poznaliśmy już funkcję `map`, wyczyszczenie naszych baz nie powinno stanowić problemu. Mamy listę baz. Ten sam zestaw funkcji czyszczących musimy zastosować do każdej bazy z listy. Żeby zastosować funkcję do każdego elementu używamy właśnie `map` lub `apply`. Problem polega jednak na tym, że nie mamy pojedynczej funkcji czyszczącej, a cały wielki zestaw tych funkcji. W rzeczywistości nie jest to żaden problem, bo jak dowiedzieliśmy się [tutaj](https://nieobliczalne.pl/posts/podstawy_R.html#sec-customfunctions), możemy nasz zestaw przerobić na pojedynczą funkcję.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwyczysc <- function(df) {\n    metryczka <- df %>%\n        slice(1:2) %>% # wybierz wiersze z samej metryczki\n        select(participant, expName, 2, 4) %>% # wybierz kolumny z id, pytaniem i odpowiedzią\n        pivot_wider(names_from = form.itemText, values_from = form.response) %>% # format długi\n        set_names(\"id\", \"warunek\", \"plec\", \"wiek\") %>%\n        mutate(\n            wiek = parse_number(wiek),\n            warunek = str_remove(warunek, \"eksperyment_\") # zostaw samo łatwy albo trudny\n        )\n\n    pytania <- df %>%\n        slice(4:11) %>%\n        select(form_2.itemText, form_2.response) %>%\n        mutate(\n            form_2.response = case_match( # tak i nie na 1 i 0\n            form_2.response,\n            \"tak\" ~ 1,\n            \"nie\" ~ 0\n            )\n        ) %>%\n        pivot_wider(names_from = form_2.itemText, values_from = form_2.response) %>%\n        set_names(paste0(\"pyt_\", 1:8))\n\n    bind_cols(metryczka, pytania) %>%\n        mutate(\n            id = stringi::stri_rand_strings(1, 5) # zamień id na losowe znaki\n        )\n}\n```\n:::\n\n\nUzyskałem w ten sposób funkcję `wyczysc`, która wykonuje wszystkie nasze przekształcenia. Warto zwrócić uwagę, że bazę danych nazwałem `df` i zrobiłem z niej argument naszej funkcji, a także ostatni blok nie ma przypisania do zmiennej `baza`. Wynika to z tego, że domyślnie funkcje w R zwracają ostatnią rzecz, którą zrobią, czyli tutaj połączoną bazę. Jeśli zapisałbym ostateczną bazę do zmiennej `baza`, musiałbym w ostatniej linijce dopisać samo `baza` albo `return(baza)`, jako że to jest to, co funkcja ma nam ostatecznie dać -- wyczyszczoną bazę.\n\nUżyjmy teraz naszej nowej funkcji `wyczysc` do wyczyszczenia naszych plików.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbazy <- map(bazy_lista, wyczysc)\n```\n:::\n\n\nEfektem działania tej funkcji jest lista wyczyszczonych baz, z których każda ma tylko jeden wiersz (bo tak zrobiliśmy nasze czyszczenie). Jednak do analizy statystycznej nie jest potrzebna lista, tylko pojedyncza baza. Połączmy więc naszą listę w pojedynczą bazę za pomocą funkcji `bind_rows`. Możemy ją wywołać na nowopowstałej zmiennej `bazy` albo już wcześniej dodać ją potokiem do mapowania.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# tak jest dobrze\nbazy <- map(bazy_lista, wyczysc)\nbazy <- bind_rows(bazy)\n\n# tak też jest dobrze\nbazy <- map(bazy_lista, wyczysc) %>%\n    bind_rows()\n\nbazy\n```\n\n<div class=\"sourceCode\"><pre class=\"sourceCode\"><code class=\"sourceCode\"><span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># A tibble: 35 × 12</span>\n<span style='color: #555555;'>#&gt;</span>    <span style='font-weight: bold;'>id</span>    <span style='font-weight: bold;'>warunek</span> <span style='font-weight: bold;'>plec</span>       <span style='font-weight: bold;'>wiek</span> <span style='font-weight: bold;'>pyt_1</span> <span style='font-weight: bold;'>pyt_2</span> <span style='font-weight: bold;'>pyt_3</span> <span style='font-weight: bold;'>pyt_4</span> <span style='font-weight: bold;'>pyt_5</span> <span style='font-weight: bold;'>pyt_6</span> <span style='font-weight: bold;'>pyt_7</span> <span style='font-weight: bold;'>pyt_8</span>\n<span style='color: #555555;'>#&gt;</span>    <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>   <span style='color: #555555; font-style: italic;'>&lt;chr&gt;</span>     <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span> <span style='color: #555555; font-style: italic;'>&lt;dbl&gt;</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 1</span> nN3zb trudny  kobieta      20     <span style='color: #555555;'>0</span>     1     1     <span style='color: #555555;'>0</span>     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     1\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 2</span> 9X7x2 latwy   kobieta      21     1     1     1     1     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     1\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 3</span> Awyis latwy   mezczyzna    24     1     1     <span style='color: #555555;'>0</span>     1     1     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 4</span> y2Rdz latwy   kobieta      17     1     <span style='color: #555555;'>0</span>     1     1     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     1\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 5</span> JrXsV trudny  mezczyzna    17     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     1     1     1     1     1     1\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 6</span> rrL0C latwy   mezczyzna    23     1     <span style='color: #555555;'>0</span>     1     1     1     1     <span style='color: #555555;'>0</span>     1\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 7</span> wHsx0 trudny  kobieta      17     1     <span style='color: #555555;'>0</span>     1     1     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     1\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 8</span> YDejs trudny  kobieta      17     <span style='color: #555555;'>0</span>     1     1     1     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'> 9</span> Ntqj2 latwy   mezczyzna    20     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>     1     1     1     1     <span style='color: #555555;'>0</span>     <span style='color: #555555;'>0</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'>10</span> KkuCT latwy   kobieta      20     1     1     <span style='color: #555555;'>0</span>     1     <span style='color: #555555;'>0</span>     1     1     <span style='color: #555555;'>0</span>\n<span style='color: #555555;'>#&gt;</span> <span style='color: #555555;'># ℹ 25 more rows</span>\n</code></pre></div>\n:::\n\n\nOstatecznie uzyskujemy piękną, czystą i pojedynczą bazę danych, na której możemy wykonywać analizy.\n\n# Pętle\n\nPętle to w wielu językach programowania podstawowa metoda automatyzacji. Pozwalają nam wykonać tę samą operację wiele, wiele razy, za każdym razem coś zmieniając. W R ich za bardzo nie używamy. W sensie można, ale ponieważ R to język typowo przeznaczony do analizy statystycznej. Nie jest to język ogólnego przeznaczenia, dlatego rzadko musimy robić w nim rzeczy, których nie możemy zrobić listami i `map`. Dlatego ta druga opcja jest preferowana w R i R jest zoptymalizowane pod listy, zaś pętle działają, ale ich efektywność przy dużej ilości plików pozostawia wiele do życzenia. Jednak czasami może się przydać. Co więcej, czasami da się coś zrobić listą, ale łatwiej to *zrozumieć*, gdy używamy pętli. Na sam początek pętle mogą być przyjemniejsze w odbiorze dla niewprawionego programisty (albo właśnie wprawionego, który zna pętle z innych języków). Istnieją dwa rodzaje pętli -- `for` i `while`.\n\n## Pętle `for`\n\nPętla `for` służy do wykonania danej czynności określoną liczbę razy albo dla określonych rzeczy. Tutaj przykład wykorzystania tej pętli do wykonania czynności, którą robiliśmy wcześniej, czyli ładowania baz danych na podstawie listy plików.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbazy_lista <- list.files(\"./dane/automatyzacja\", full.names = TRUE)\nbazy <- list() # pusta lista na przyszłość\n\nfor (i in 1:35) {\n    bazy[[i]] <- read_csv(bazy_lista[[i]], show_col_types = FALSE, name_repair = \"unique_quiet\")\n}\n```\n:::\n\n\nZapis ten jest bardziej programistyczny i korzysta z klasycznego R. To, co tutaj robimy, to tworzymy pustą listę `bazy`. Następnie pętla `for` wykona to, co zapisaliśmy w jej klamrach, za każdym razem zamieniając `i` na kolejną liczbę. Czyli najpierw wczyta bazę ze ścieżki `bazy_lista[[1]]`, potem `bazy_lista[[2]]` i tak dalej aż do `bazy_lista[[35]]`. Wczytane bazy zapisze do listy `bazy` na stosownym miejscu. `1:35` moglibyśmy zamienić na `1:length(bazy_lista)`, żeby nie zapisywać na sztywno `35`, a podstawić tam naszą liczbę plików (czyli długość zmiennej `bazy_lista`).\n\nMoglibyśmy też użyć nieco innej składni.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbazy_lista <- list.files(\"./dane/automatyzacja\", full.names = TRUE)\nbazy <- list() # pusta lista na przyszłość\n\nfor (i in bazy_lista) {\n    bazy <- c(\n        bazy,\n        list(read_csv(i, show_col_types = FALSE, name_repair = \"unique_quiet\"))\n    )\n}\n```\n:::\n\n\nNie jest to najlepszy, najbardziej wydajny kod z dobrze zaplanowaną pamięcią, ale nie chcę wchodzić w bardziej zaawansowane koncepcje jak rezerwowanie miejsca w pamięci przed uruchomieniem pętli. Ta składnia działa nieco inaczej, bo `i` nie jest tutaj liczbą, tylko kolejnymi ścieżkami do naszych plików i to one lądują w `read_csv`. Wczytaną bazę dołączam do listy baz za pomocą `c`. Co ważne, nasza nowa baza też musi mieć format listy, dlatego całe `read_csv` opakowałem w `list`.\n\nJak widać, takie rozwiązanie wymaga podejścia do R od bardziej programistycznej strony. Tak jak jednak wspominałem, w rzeczywistości rzadko jest to potrzebne, bo możemy używać funkcji `apply` lub `map`.\n\n## Pętle `while`\n\nPętle `while` wykonują jakieś polecenie tak długo, dopóki spełniony jest warunek, który jej podamy. Musimy być jednak ostrożni, bo jeśli ten warunek nie zostaje osiągnięty (bo np. źle go zaplanowaliśmy), to pętla będzie działała w nieskończoność, nierzadko zapychając pamięć komputera. Pętla `while`, choć wykorzystywana nawet rzadziej niż pętla `for`, przydała mi się w celach testowo-dydaktycznych, bo wykorzystywałem ją do znalezienia zbioru losowych liczb o określonych parametrach statystycznych. Żeby podać przykład:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nliczby <- rnorm(100, mean = 101, sd = 15)\n\nwhile (mean(liczby) != 105) {\n    liczby <- rnorm(100, mean = 101, sd = 15) %>%\n        round()\n}\n```\n:::\n\n\nTen kod wykorzystałem do znalezienia zestawu 100 losowych liczb z rozkładu normalnego IQ ($M = 100$, $SD = 15$), których średnia będzie wynosiła dokładnie 101. Wykorzystałem to [w tekście o wartości $p$](https://nieobliczalne.pl/posts/p-value.html) do znalezienia ładnej próbki, której średnia nie będzie wynosiła dokładnie tyle, ile średnia z populacji. Funkcja `rnorm` losuje liczby z rozkładu normalnego o podanych parametrach 5, `round` zaokrągla je do całości. Pętla `while` mówi tutaj „Sprawdź, czy średnia wylosowanych liczb nie równa się 105. Jeśli nie, to wylosuj ponownie.” albo inaczej „Powtarzaj losowanie dopóki średnia liczb nie będzie się równała 101”.\n\n# Podsumowanie\n\n1. R daje nam duże możliwości automatyzacji powtarzalnych czynności.\n2. Podstawową metodą automatyzacji w R są listy.\n3. Funkcja `map` (`apply`) stosuje daną funkcję do każdego elementu listy.\n4. W R istnieją pętle, ale lepiej ich unikać.\n5. Pętla `for` powtarza zestaw funkcji określoną liczbę razy albo dla wszystkich wartości zbioru.\n6. Pętla `while` powtarza zestaw funkcji tak długo, jak spełniony jest podany jest warunek.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}